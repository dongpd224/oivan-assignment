<div class="house-list-container">
  <!-- Filter Section -->
  <div class="filter-section">
    <lib-houses-house-filter
      [availableBlocks]="availableBlocks()"
      [availableLands]="availableLands()"
      [initialFilter]="currentFilter()"
      [showCreateButton]="isAuthenticated()"
      (filterChange)="onFilterChange($event)"
      (filterClear)="onFilterClear()"
      (createHouse)="createHouse()">
    </lib-houses-house-filter>
  </div>

  <!-- Content Section -->
  <div class="content-section">
    <div class="content-header">
      <h2 class="h4 mb-1">Available Houses</h2>
      @if (!loading() && housesCount() > 0) {
        <p class="text-muted small mb-0">
          Total {{ housesCount() }} house{{ housesCount() !== 1 ? 's' : '' }}
        </p>
      }
    </div>

    @if (loading()) {
      <lib-shared-loading-spinner message="Loading houses..."></lib-shared-loading-spinner>
    }

    @if (error() && !loading()) {
      <lib-shared-error-message 
        type="error"
        title="Failed to Load Houses"
        [message]="error() ?? ''"
        (retry)="loadHouses()">
      </lib-shared-error-message>
    }

    @if (!loading() && !error()) {
      <!-- Accordion Section for Grouped Houses -->
      @if (groupedHouses().length > 0) {
        <mat-accordion class="house-models-accordion" multi>
          @for (group of groupedHouses(); track group.model.id) {
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  {{ group.modelName }} ({{ group.housesCount }} house{{ group.housesCount !== 1 ? 's' : '' }})
                </mat-panel-title>
              </mat-expansion-panel-header>

              <!-- Model Media Section -->
              <div class="model-media-section">
                <div class="media-content">
                  @if (group.mediaTitle) {
                    <h3 class="media-title">{{ group.mediaTitle }}</h3>
                  }
                  @if (group.mediaDescription) {
                    <p class="media-description">{{ group.mediaDescription }}</p>
                  }
                  @if (group.hasVideo()) {
                    <!-- This call so many apis -->
                    <!-- <lib-houses-youtube-embed [videoUrl]="group.mediaVideo!" /> -->
                  }
                </div>
                @if (group.mediaBanner) {
                  <img [src]="group.mediaBanner" 
                       [alt]="group.mediaTitle || group.modelName" 
                       class="media-banner"
                       (error)="$event.target.src = 'https://www.shutterstock.com/shutterstock/photos/2600014993/display_1500/stock-photo-white-modern-house-with-dark-gray-roof-and-fence-standing-against-clear-blue-sky-representing-2600014993.jpg'">
                }
              </div>

              <!-- Houses Table -->
              <div class="houses-table-section">
                <lib-houses-house-table
                  [houses]="group.houses"
                  [showEditActions]="isAuthenticated()"
                  (viewDetails)="onViewDetails($event)"
                  (edit)="onEditHouse($event)">
                </lib-houses-house-table>
              </div>
            </mat-expansion-panel>
          }
        </mat-accordion>
      }

      @if (groupedHouses().length === 0 && housesCount() === 0) {
        <div class="text-center py-4 py-md-5">
          <mat-icon class="display-1 text-muted opacity-50">home_work</mat-icon>
          <h3 class="h5 mt-3">No houses found</h3>
          <p class="text-muted">{{ currentFilter() ? 'Try adjusting your filters to see more results.' : 'No houses are currently available.' }}</p>
          @if (currentFilter()) {
            <button mat-stroked-button color="primary" (click)="onFilterClear()">Clear Filters</button>
          }
        </div>
      }
    }
  </div>
</div>
