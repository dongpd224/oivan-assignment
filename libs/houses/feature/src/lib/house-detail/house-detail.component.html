<div class="container py-4" style="max-width: 1200px;">
  <div class="d-flex align-items-center justify-content-between mb-4 flex-wrap gap-3">
    <div class="d-flex align-items-center gap-3">
      <button mat-icon-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1 class="h3 mb-0">{{ pageTitle }}</h1>
    </div>
    @if (house() && !isFormMode) {
      <button mat-flat-button color="primary" (click)="editHouse()">
        <mat-icon>edit</mat-icon> Edit House
      </button>
    }
  </div>

  @if (loading()) {
    <lib-shared-loading-spinner message="Loading house details..."></lib-shared-loading-spinner>
  }

  @if (error() && !loading()) {
    <lib-shared-error-message 
      type="error"
      title="Failed to Load House"
      [message]="error()"
      [showRetry]="true"
      (retry)="loadHouse()">
    </lib-shared-error-message>
  }

  <!-- Form Mode (Create/Edit) -->
  @if (isFormMode && !loading()) {
    <lib-houses-house-form
      [house]="house() ?? undefined"
      [isSubmitting]="isSubmitting"
      (formSubmit)="onFormSubmit($event)"
      (formCancel)="onFormCancel()">
    </lib-houses-house-form>
  }

  <!-- View Mode -->
  @if (house() && !loading() && !isFormMode) {
    <div class="row g-4">
      <!-- Main Info Card -->
      <div class="col-12">
        <div class="card bg-primary text-white shadow">
          <div class="card-body">
            <h2 class="card-title h4">{{ house()?.getFullHouseNumber() }}</h2>
            <p class="card-subtitle opacity-75 mb-3">{{ house()?.houseType }} - {{ house()?.model }}</p>
            <span class="badge" [class.bg-success]="house()?.status === houseStatus.AVAILABLE" [class.bg-warning]="house()?.status !== houseStatus.AVAILABLE">
              {{ house()?.status }}
            </span>
            <div class="mt-4">
              <small class="opacity-75">Price</small>
              <div class="h2 mb-0">{{ house()?.price }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Location -->
      <div class="col-md-6">
        <div class="card h-100 shadow-sm">
          <div class="card-header bg-transparent d-flex align-items-center gap-2">
            <mat-icon>location_on</mat-icon>
            <span class="fw-semibold">Location Information</span>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between"><span class="text-muted">Block Number</span><span>{{ house()?.blockNumber }}</span></li>
            <li class="list-group-item d-flex justify-content-between"><span class="text-muted">Land Number</span><span>{{ house()?.landNumber }}</span></li>
            <li class="list-group-item d-flex justify-content-between"><span class="text-muted">Full Address</span><span>Block {{ house()?.blockNumber }}, Land {{ house()?.landNumber }}</span></li>
          </ul>
        </div>
      </div>

      <!-- Property Details -->
      <div class="col-md-6">
        <div class="card h-100 shadow-sm">
          <div class="card-header bg-transparent d-flex align-items-center gap-2">
            <mat-icon>home</mat-icon>
            <span class="fw-semibold">Property Details</span>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between"><span class="text-muted">House Type</span><span>{{ house()?.houseType }}</span></li>
            <li class="list-group-item d-flex justify-content-between"><span class="text-muted">House Model</span><span>{{ house()?.model }}</span></li>
            <li class="list-group-item d-flex justify-content-between"><span class="text-muted">House Number</span><span>{{ house()?.houseNumber }}</span></li>
          </ul>
        </div>
      </div>
    </div>
  }
</div>
