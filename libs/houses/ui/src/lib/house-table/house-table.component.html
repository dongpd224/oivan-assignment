<div class="house-table-container">
  <mat-table [dataSource]="dataSource" matSort (matSortChange)="onSortChange($event)" class="houses-table">
    
    <!-- House Number Column -->
    <ng-container matColumnDef="houseNumber">
      <mat-header-cell *matHeaderCellDef mat-sort-header>House Number</mat-header-cell>
      <mat-cell *matCellDef="let house">{{ house.getFullHouseNumber() }}</mat-cell>
    </ng-container>

    <!-- House Type Column -->
    <ng-container matColumnDef="houseType">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Type</mat-header-cell>
      <mat-cell *matCellDef="let house">{{ house.houseType }}</mat-cell>
    </ng-container>

    <!-- House Model Column -->
    <ng-container matColumnDef="houseModel">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Model</mat-header-cell>
      <mat-cell *matCellDef="let house">{{ house.houseModel }}</mat-cell>
    </ng-container>

    <!-- Price Column -->
    <ng-container matColumnDef="price">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Price</mat-header-cell>
      <mat-cell *matCellDef="let house" class="price-cell">{{ house.getFormattedPrice() }}</mat-cell>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Status</mat-header-cell>
      <mat-cell *matCellDef="let house">
        <mat-chip 
          [color]="house.status === houseStatus.AVAILABLE ? 'primary' : 'warn'"
          selected>
          {{ house.status }}
        </mat-chip>
      </mat-cell>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
      <mat-cell *matCellDef="let house">
        <button mat-icon-button (click)="onViewDetails(house)" matTooltip="View Details">
          <mat-icon>visibility</mat-icon>
        </button>
        @if (showEditActions) {
          <button 
            mat-icon-button 
            (click)="onEdit(house)" 
            matTooltip="Edit House">
            <mat-icon>edit</mat-icon>
          </button>
        }
      </mat-cell>
    </ng-container>

    <!-- Expandable Detail Row -->
    <ng-container matColumnDef="expandedDetail">
      <mat-cell *matCellDef="let house" [attr.colspan]="displayedColumns.length">
        <div class="house-detail-expansion" [@detailExpand]="house == expandedHouse ? 'expanded' : 'collapsed'">
          <div class="house-detail-content">
            <div class="detail-section">
              <h4>Location Details</h4>
              <p><strong>Block:</strong> {{ house.blockNumber }}</p>
              <p><strong>Land:</strong> {{ house.landNumber }}</p>
            </div>
            
            @if (house.description) {
              <div class="detail-section">
                <h4>Description</h4>
                <p>{{ house.description }}</p>
              </div>
            }
            
            @if (house.media && house.media.length > 0) {
              <div class="detail-section">
                <h4>Media</h4>
                <div class="media-list">
                  @for (media of house.media; track media) {
                    <span class="media-item">{{ media }}</span>
                  }
                </div>
              </div>
            }
            
            <div class="detail-actions">
              <button mat-raised-button color="primary" (click)="onViewDetails(house)">
                View Full Details
              </button>
            </div>
          </div>
        </div>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row 
      *matRowDef="let house; columns: displayedColumns;"
      class="house-row"
      [class.expanded-row]="expandedHouse === house"
      (click)="toggleExpansion(house)">
    </mat-row>
    <mat-row 
      *matRowDef="let house; columns: ['expandedDetail']; when: isExpansionDetailRow"
      class="detail-row">
    </mat-row>
  </mat-table>

  @if (showPagination) {
    <mat-paginator 
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  }
</div>